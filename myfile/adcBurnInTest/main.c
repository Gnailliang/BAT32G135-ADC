/***********************************************************************************************************************
* Copyright (C) . All rights reserved.
***********************************************************************************************************************/

/***********************************************************************************************************************
* File Name    : main.c
* Version      :  
* Device(s)    : BAT32G135
* Tool-Chain   : MDK(armcc)
* Description  : This file is a template.
* Creation Date: 2019/4/30
***********************************************************************************************************************/

/***********************************************************************************************************************
Macro Definitions
***********************************************************************************************************************/

/***********************************************************************************************************************
Includes
***********************************************************************************************************************/
#include <stdio.h>
#include "BAT32G135.h"
#include "userdefine.h"
#include "adc.h"
#include "sci.h"
#include "dma.h"

/***********************************************************************************************************************
Global variables and functions
***********************************************************************************************************************/
volatile uint32_t g_ticks;
uint16_t get_value[256];

int main()
{
	MD_STATUS status;
	uint32_t i;
	
//-----------------------------------------------------------------------
// Init UART0 for retarget printf/scanf etc. 
//----------------------------------------------------------------------- 
#if 1
	SystemCoreClockUpdate();
	status = UART0_Init(SystemCoreClock, 19200);
	if(status == MD_ERROR)
	{
		while(1);
	}
	
	printf("Hello, UART\n");
#endif
	
//-----------------------------------------------------------------------
// ADC channel 2 input
//-----------------------------------------------------------------------
	DMA_Start(DMA_VECTOR_ADC, CTRL_DATA_ADC, DMA_MODE_REPEAT, 
		        DMA_SIZE_HALF, 256, (uint16_t *)&ADC->ADCR, get_value);
	ADC_Init();					
	ADC_Set_Clock(CLOCK_DIV16, 0x0DU);
	ADC_Start(ADC_CHANNEL_2);

	while(1)
	{
		g_AdcIntTaken = 0;
		while(g_AdcIntTaken <20);
		printf("ADCR = 0x%04X\n", get_value[0]);
	}
	ADC_Stop();	
}
/***********************************************************************************************************************
* Function Name: SysTick Handler
* Description  : Decreament the g_ticks value
* Arguments    : None
* Return Value : None
***********************************************************************************************************************/
void SysTick_Handler(void)
{
	g_ticks--;
}

